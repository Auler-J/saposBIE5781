---
title: "Efeitos de sinais multimodais ao tempo até o início do amplexo: um estudo de simulação"
author: "Daniel YM Nakamura e Jennifer P Auler"
date: '2022-11-08'
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 1. Introdução

Em anuros, o canto de anúncio é aquele emitido por machos para atrair fêmeas ou repelir machos competidores na paisagem acústica (Wells 1977). Na espécie *Hylodes asper* (Anura: Hylodidae), machos de anuros geralmente são sedentários e esperam até as fêmeas chegarem nos sítios reprodutivos (superfícies de rochas próximas a rios ou cachoeira). A maioria dos estudos utiliza aspectos temporais (e.g. taxa de cantos) ou espectrais (i.e. o quão agudo ou grave o canto é) como variáveis respostas de modelos. Contudo, o tempo em que as fêmeas demoram para chegar nos sítios reprodutivos e iniciarem o amplexo é pouco estudado.

Existem sinais multimodais compostos por características morfológicas, acústicas e visuais que são consideradas mais atrativas pelas fêmeas e podem explicar o tempo até sua chegada e início do amplexo. Por exemplo, é possível que machos que cantem a uma **taxa de notas** mais alta (maior número de notas por unidade de tempo) sejam mais atrativos e reduzam o tempo até o amplexo, pois uma taxa maior indica um maior gasto de energia e uma maior exposição a predadores, o que pode indicar um sinal honesto da qualidade do macho. Outra possível preditora acústica é a **frequência dominante** do canto, no qual cantos mais graves são considerados mais atrativos e talvez reduzam o tempo até o início do amplexo, pois machos com canto mais grave geralmente tem cordas vocais mais grossas e compridas, o que geralmente é um sinal honesto que informa o tamanho corporal do macho. Contudo, existem machos que mentem! Machos mentirosos são comuns em algumas espécies, os quais conseguem modular a frequência do canto (deixar mais grave por relaxamento dos músculos da cartilagem aritenóide). Por isso, incluir o **tamanho corporal** como uma variável preditora é uma forma de avaliar a honestidade da frequência. Por fim, machos da espécie *Hylodes asper* às vezes cantam ao mesmo tempo em que apresentam um display visual chamado *foot-flagging*, no qual esticam as pernas para chamarem atenção das fêmeas visualmente devido ao barulho das corredeiras que podem reduzir as chances de serem escutados pelas fêmeas. Portanto, uma última hipótese é que uma taxa de foot-flagging alta reduza o tempo até as fêmeas iniciarem o amplexo.

![](./fig1.png)

# 2. Material e métodos

## 2.1 Simulação de dados

```{r ass.function}
load("R/funcoes_auxiliares.R")
load("R/saposim.R")
```

A cada simução é criada uma nova matriz de \code{espaco} de \code{area} linhas e \code{area} colunas. Em seguida, são sorteadas as posições dos \code{nmacho} daquela simulação. A probabilidade de seleção de cada macho é calculada em função da sua frequência de canto \code{freq} (Hz), taxa de footflag \code{foot} (footflag/minuto) e tamanho corporal \code{tama} (cm). Estas caracteristicas são padronizadas pela função \code{padroniza} e aparecem no output como \code{freqpad}, \code{footpad} e \code{tamapad}. É esperado que machos mais próximos a cachoeira tenham: maior taxa de footflag, menor tamanho corporal e vocalizem em frequencias mais agudas, portanto tenham probabilidade menor de atrair fêmeas. Apesar de estes valores serem correlacionados, as características no macho são sorteadas de uma distribuição aleatória. Uma cédula é então sorteada para a fêmea ocupar, e esta escolhe um macho para copular com probabilidade \code{prob}. A distância \code{distf} entre a fêmea e o macho escolhido é calculada pela função \code{dist}. A fêmea e o macho são considerados ocupados até o final da simulação e são retirados do \code{espaco}. A simulação se repete com \code{nfemea} = \code{nmacho}. O tempo total \code{ttot} o macho ser escolhido também é guardado, sendo definido como a soma de todas \code{distf} anteriores.

```{r figura, echo=FALSE}
par(mar = c(0,0,1,0))

#plot vazio
plot(NULL, xlim = c(-2, 12), ylim = c(-2, 12), ann = FALSE, xaxt = "n", yaxt = "n", bty = "n", asp = 1)

#faz grid
segments(x0 = -1:11, x1 = -1:11, y0 = rep(-1, 11), y1 = rep(11, 11))
segments(x0 = rep(-1, 11), x1 = rep(11, 11), y0 = -1:11, y1 = -1:11)

#cria cachoeira
mtext(text = "area = 12", at = 5, side = 3, line = 0)
rect(xleft = 11, ybottom = -2, xright = 12, ytop = 12, col = "lightblue")

#faz labels
text(x = -0.5:10.5, y = 11.5, paste0("C", 1:12), cex = 0.5)
text(x = -1.5, y =  -0.5:10.5, paste0("L", 12:1), cex = 0.5)
text(x = 11.5, y =  5, "cachoeira", cex = 1.5, srt = 270)

#plota machos
text(x = c(3, 10,  2,  1,  2,  7,  9,  6,  0,  3)+0.5, y = c(9,  1,  8,  9,  5,  4,  2,  8, -1, -1)+0.5, paste0("m", 1:10), cex = c(0.58, 0.29, 0.63, 0.52, 0.58, 0.47, 0.51, 0.40, 0.51, 0.7), col = c(rep("black", 9), "blue")) 

#plota femea
text(x = 4.5, y = 5.5, "F", col = "red")

#distancia entre macho escolhido e femea
segments(x0 = 3.5, x1 = 4.3, y0 = -0.5, y1 = 5.5, lty = 2, col = "green")
text(x = 4.15, y = 2.5, "distf = 7.3", col = "green", cex = 0.7)
```
Figura X - Uma distribuição hipotética de machos (m1 a m10) e fêmea (F) no espaço. A probabilidade de seleção dos machos está representada pelo tamanho da fonte. Ao lado direito se encontra a cachoeira, que se correlaciona com a probabilidade de seleção. Neste exemplo, o macho "m10" foi escolhido e a sua distancia "distf" foi calculada. 

# 3. Simulação

```{r}
set.seed(42)
#sim1 = saposim(nsim = 10000)
#save(sim1, file = "sim1.Rdata")
load("data/sim1.Rdata")
summary(sim1) # @rada, os valores fazem sentido??
```


# 4. Analise dos resultados

```{r}
library(lme4)
library(MASS)

# Análise exploratória
hist(sim1$ttot)
plot(sim1$ttot ~ sim1$prob)
plot(sim1$ttot ~ sim1$footpad)
plot(sim1$ttot ~ sim1$freqpad)
plot(sim1$ttot ~ sim1$tamapad)

# Modelos Mistos Generalizados
glmm1 = glmer(ttot~tamapad*freqpad*footpad*area + (1|nsim), family = Gamma, data=sim1)
# glmm2 = glmer(ttot~tamapad+freqpad+footpad+area + tamapad:freqpad + freqpad:footpad +tamapad:footpad
#              + (1|nsim), family = Gamma, data=sim1)
AICtab(glmm1, glmm2)  #melhor glmm e o modelo cheio com interacoes


# Modelos Generalizados
glm1 = glm(ttot~tamapad*freqpad*footpad*area, family = Gamma, data=sim1)
stepAIC(glm1) #melhor glm e o modelo cheio com interacoes

logit2prob(coef(glm1))

#Comparacao de modelos
AICtab(glmm1, glm1, base = TRUE)

confint(glm1) < 0 & confint(glm1) > 0
```

