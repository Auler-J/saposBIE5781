---
title: "Como sinais multimodais influenciam o tempo até o início do amplexo?"
author: "Daniel YM Nakamura e Jennifer P Auler"
date: '2022-11-08'
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 1. Introdução

<center><img src="fig1.png" width="400"></center>
<center>Figura 1: Ilustração de rã-de-corredeira (Hylodidae: Hylodes asper). Fonte: Paulo Presti.</center>

\

Em anuros, o canto de anúncio é aquele emitido por machos para atrair fêmeas ou repelir machos competidores na paisagem acústica (Wells 1977; Duellman & Trueb 1986). A maioria das espécies de anuros apresentam comportamento noturno e portanto são altamente dependentes do canto para se reproduzirem. Contudo, na espécie *Hylodes asper* (Anura: Hylodidae) os machos apresentam comportamento diurno, sedentário e esperam até as fêmeas chegarem nos sítios reprodutivos, onde cantam em superfícies de rochas próximas a águas lóticas (i.e. rios de correnteza intensa ou cachoeiras; Heyer et al. 1990; Haddad & Giaretta 1999). Devido à disponibilidade de luz e ao ruído de fundo das correntezas, sinais visuais podem ser apresentados concomitantemente aos sinais acústicos para maximizar a transmissão de informação entre o macho emissor e as fêmeas ou machos receptores (Hödl et al. 1997). Embora a maioria dos estudos utilize aspectos temporais (e.g. taxa de cantos) ou espectrais (i.e. o quão agudo ou grave o canto é) como variáveis respostas de modelos (e.g. Gingras et al. 2013; Goutte et al. 2016), o tempo em que as fêmeas demoram para chegar nos sítios reprodutivos e iniciarem o amplexo é pouco estudado.

Existem sinais multimodais compostos por características morfológicas, acústicas e visuais que são consideradas mais atrativas pelas fêmeas e podem explicar o tempo até sua chegada e início do amplexo. Por exemplo, uma possível preditora acústica é a **frequência dominante** do canto (DF: a banda com maior concentração de energia no espectro; Köhler et al. 2017), no qual cantos mais graves são considerados mais atrativos e talvez reduzam o tempo até o início do amplexo, pois machos com canto mais grave geralmente tem cordas vocais mais espessas e compridas (McClelland et al. 1996), o que geralmente é um sinal honesto que informa o tamanho corporal do macho (Wells 2007; Köhler et al. 2017). Contudo, existem machos que mentem! Machos mentirosos são comuns em algumas espécies, os quais conseguem modular a frequência do canto (i.e. deixar mais grave por relaxamento dos músculos da cartilagem aritenóide; Martin 1971; Schmid 1979; Ryan 1988). Por isso, incluir o **tamanho corporal** como uma variável preditora é uma forma de avaliar a honestidade da frequência. Por fim, machos da espécie *Hylodes asper* às vezes cantam ao mesmo tempo em que apresentam um display visual chamado <strong><em>foot-flagging</em></strong>, no qual esticam as pernas para chamarem atenção das fêmeas visualmente devido ao barulho das corredeiras que podem reduzir as chances de serem escutados pelas fêmeas (Heyer et al. 1990; Haddad & Giaretta 1999). Portanto, uma última hipótese é que uma taxa de foot-flagging alta reduza o tempo até as fêmeas iniciarem o amplexo.

# 2. Objetivos e hipóteses

O objetivo geral desse trabalho é responder como sinais multi-modais influenciam o tempo até o início do amplexo em *Hylodes asper*. Os objetivos específicos são entender:

1. Como os sinais espectrais de frequência dominante (DF) influenciam o tempo até o início do amplexo?
- H0: Não há influência da DF sobre o tempo até o início do amplexo
- H1: DF é positivamente relacionada com o tempo até o início do amplexo, de modo que machos com canto mais grave (menor DF) copulam antes (menor tempo até o início do amplexo)

2. Como o tamanho corporal influencia o tempo até o início do amplexo?
- H0: Não há influência do tamanho corporal sobre o tempo até o início do amplexo
- H1: Tamanho corporal é negativamente relacionada com o tempo até o início do amplexo, de modo que machos maiores copulam antes

3. Como os sinais visuais de taxa de *foot-flagging* influenciam o tempo até o início do amplexo?
- H0: Não há influência da taxa de *foot-flagging* sobre o tempo até o início do amplexo
- H1: Taxa de *foot-flagging* é negativamente relacionada com o tempo até o início do amplexo, de modo que machos que dançam mais copulam antes

<center><img src="fig2.png" width="500"></center>
<center>Figura 2: Predições para as perguntas do trabalho. Espera-se uma (I) relação positiva entre frequência dominante (DF) e tempo até o amplexo, (II) relação negativa entre tamanho corporal e tempo até o amplexo, e (III) relação negativa entre taxa de foot-flagging e tempo até o amplexo.</center>

\

# 3. Simulação de dados

Embora dados das nossas variáveis preditoras sejam mais acessíveis na literatura, dados da nossa variável resposta (tempo de espera da fêmea até início da cópula) são escassos. Isso ocorre pois é extremamente custoso ao biólogo de campo tentar localizar uma fêmea de anuro próxima dos machos já que elas não cantam e raramente são vistas na natureza. Portanto, optamos pelo uso de dados simulados.

As nossas variáveis preditoras teóricas são frequência do canto, tamanho corporal e *display* de *foot-flagging*. Contudo, precisamos operacionalizar essas variáveis. Utilizamos as seguintes variáveis preditoras operacionais:

- Frequência dominante (DF: medida em Hz), definida como a frequência no espectro harmônico com maior concentração de energia que é percebida pelo ouvido humano como o quão grave ou agudo os sons são (Köhler et al. 2017); 

- Comprimento rostro-cloacal (SVL: *snout-vent length*, medida em mm), o qual é amplamente usado como aproximação do tamanho corporal pois mede o comprimento da extremedidade anterior do focinho até a extremidade posterior da cloaca (Duellman 1970); 

- Taxa de *foot-flagging* (medida em número de eventos/minuto). 

Para *Hylodes asper*, Haddad & Giaretta (1999) reportaram que a DF se encontra no terceiro harmônico entre 5000 a 6500 Hz, com valor de *midpoint* ([máx - min] / 2) igual a 5750 Hz. Heyer et al. (1990) reportaram que os machos apresentam um SVL médio de 40.5 mm (39.4-42.3 mm). Já a taxa de *foot-flagging* não foi reportada por unidade de tempo em nenhum destes trabalhos, mas é possível estimar através de vídeos disponíveis no YouTube (~10 a cada 5 min). Utilizamos estes valores como referência das características dos machos simulados na função 'saposim'.

```{r ass.function}
source("R/funcoes_auxiliares.R")
source("R/saposim.R")
```

A cada simução é criada uma nova matriz de <code>espaco</code> de <code>area</code> linhas e <code>area</code> colunas. Em seguida, são sorteadas as posições dos <code>nmacho</code> daquela simulação. A frequência dominante do canto <code>freq</code> (DF: Hz), taxa de *foot-flagging* <code>foot</code> (número de eventos de *foot-flagging*/minuto) e tamanho corporal <code>tama</code> (SVL: mm) de cada um dos machos é simulada. Estas caracteristicas são sorteadas a partir de uma distribuição  (normal, poisson e normal para DF, taxa de *foot-flagging* e SVL, respectivamente) e, em seguida, padronizadas pela função <code>padroniza</code>. Os valores padronizados aparecem no output como <code>freqpad</code>, <code>footpad</code> e <code>tamapad</code>. É esperado que machos mais próximos à cachoeira tenham menor tamanho corporal (SVL menor) e vocalizem em frequencias mais agudas (DF maior) e portanto tenham, em média, probabilidade menor de atrair fêmeas. No entanto, é esperado que esses machos tenham também maior taxa de *foot-flagging*, o que pode contra-balancear essa esperança. Apesar de estes valores serem correlacionados, as características do macho são sorteadas independentemente de uma distribuição aleatória.

A probabilidade de seleção do macho é então calculada através de uma regressão logistica, 
$$P = \frac{e^{exprlin}}{1+e^{exprlin}}$$ 
com expressão linear de fórmula: $exprlin = a \times tamanho + b \times taxafootflag + c \times DF$ e intercepto igual à média da expressão linear.

Uma cédula vazia é então sorteada para a fêmea ocupar, e esta escolhe um macho para copular com probabilidade <code>prob</code>. A distância <code>distf</code> entre a fêmea e o macho escolhido é calculada pela função <code>dist</code>. A fêmea e o macho são considerados ocupados até o final da simulação e são retirados do <code>espaco</code>. A simulação se repete com <code>nfemea = nmacho</code>. O tempo total <code>ttot</code> para o macho ser escolhido também é guardado, sendo definido como a soma de todas <code>distf</code> anteriores na mesma simulação. A função de simulação de sapos, <code>saposim</code> se encontra na íntegra no arquivo "R/saposim.R".

```{r figura, echo=FALSE, fig.align = 'center'}
par(mar = c(0,0,1,0))

# Plot vazio
plot(NULL, xlim = c(-2, 12), ylim = c(-2, 12), ann = FALSE, xaxt = "n", yaxt = "n", bty = "n", asp = 1)

# Faz grid
segments(x0 = -1:11, x1 = -1:11, y0 = rep(-1, 11), y1 = rep(11, 11))
segments(x0 = rep(-1, 11), x1 = rep(11, 11), y0 = -1:11, y1 = -1:11)

# Cria cachoeira
mtext(text = "area = 12", at = 5, side = 3, line = 0)
rect(xleft = 11, ybottom = -2, xright = 12, ytop = 12, col = "lightblue")

# Faz labels
text(x = -0.5:10.5, y = 11.5, paste0("C", 1:12), cex = 0.5)
text(x = -1.5, y =  -0.5:10.5, paste0("L", 12:1), cex = 0.5)
text(x = 11.5, y =  5, "cachoeira", cex = 1.5, srt = 270)

# Plota machos
text(x = c(3, 10,  2,  1,  2,  7,  9,  6,  0,  3)+0.5, y = c(9,  1,  8,  9,  5,  4,  2,  8, -1, -1)+0.5, paste0("m", 1:10), cex = c(0.58, 0.29, 0.63, 0.52, 0.58, 0.47, 0.51, 0.40, 0.51, 0.7), col = c(rep("black", 9), "blue")) 

# Plota fêmea
text(x = 4.5, y = 5.5, "F", col = "red")

# Distância entre macho escolhido e fêmea
segments(x0 = 3.5, x1 = 4.3, y0 = -0.5, y1 = 5.5, lty = 2, col = "green")
text(x = 4.15, y = 2.5, "distf = 7.3", col = "green", cex = 0.7)
```

<center>Figura 3 - Uma distribuição hipotética de machos (m1 a m10) e fêmea (F) no espaço. A probabilidade de seleção dos machos está representada pelo tamanho da fonte. Ao lado direito se encontra a cachoeira, que se correlaciona com a probabilidade de seleção. Neste exemplo, o macho "m10" foi escolhido e a sua distancia "distf" foi calculada.</center> 

\

Além do efeito das características dos sapos, decidimos também investigar se a variação na <code>area</code> da cachoeira é relevante para o tempo até o início do amplexo. Como resultado, apresentamos então quatro simulações:

* <code>sim_Avar</code> - dimensões da cachoeira (<code>area</code>) sorteada de uma distribuição uniforme entre 10 e 100 (arredondada para números inteiros).
* <code>sim_Afix10</code> - dimensões da cachoeira (<code>area</code>) fixa em 10.
* <code>sim_Afix50</code> - dimensões da cachoeira (<code>area</code>) fixa em 50.
* <code>sim_Afix100</code> - dimensões da cachoeira (<code>area</code>) fixa em 100.


Em ambas as simulações foram mantidas os valores padrão, com exceção de <code>nsim</code>, que foi fixado em 10000. Os valores padrão da função são:

* <code>vecarea = round(runif(nsim, 10, 100), 0)</code>
* <code>vecnmacho = vecarea</code>
* <code>cffreq</code> = 1.05
* <code>cftama</code> = 0.5
* <code>cffoot</code> = 0.8

O código das simulações está no documento "R/simula_dados.R". Como <code>nsim</code> é muito grande e leva alguns minutos, salvamos o resultado das simulações como arquivos <code>R.data</code>.

```{r}
load("data/sim_Avar.Rdata")
load("data/sim_Afix10.Rdata")
load("data/sim_Afix50.Rdata")
#load("data/sim_Afix100.Rdata")
```

<details>

  <summary>Sumário de sim_Avar</summary>
```{r}
summary(sim_Avar)
```
</details>

<details>

  <summary>Sumário de sim_Afix10</summary>
```{r}
summary(sim_Afix10)
```
</details>

<details>

  <summary>Sumário de sim_Afix50</summary>
```{r}
summary(sim_Afix50)
```
</details>

<details>

  <summary>Sumário de sim_Afix100</summary>
```{r eval=FALSE}
summary(sim_Afix100) #arrumar dps pra rodar
```
</details>

# 4. Análises

Pacotes utilizados
```{r message=FALSE, warning=FALSE}
library(ggplot2)
library(gridExtra)
library(lme4)
library(MASS)
library(bbmle)
```

## 4.1 Simulação com área fixa

## 4.1.1 Área fixa em 10

Análise exploratória
```{r echo=FALSE, fig.align = 'center'}
# 1. Histograma de tempo ate inicio da copula
hist(sim_Afix10$ttot, main = "", xlab = "Tempo até início da cópula")

# 2. Scatter Plots

## 2.1 Tempo ate amplexo vs Prob. do macho ser escolhido
p1.10 = ggplot(sim_Afix10, aes(prob, ttot, color=prob)) +
  geom_point(shape=16, size = .2, show.legend = F, alpha = .5) +
  theme_minimal() +
  scale_color_gradient(low = "darkseagreen1", high = "darkslategrey") +
  xlab("\nProb. do macho ser escolhido") +
  ylab("Tempo até início da cópula\n")

## 2.2 Tempo ate amplexo vs taxa de foot-flagging
p2.10 = ggplot(sim_Afix10, aes(footpad, ttot, color=footpad)) +
  geom_point(shape=16, size=.2, show.legend=F, alpha = .5) +
  theme_minimal() +
  scale_color_gradient(low = "darkseagreen1", high = "darkslategrey") +
  xlab("\nTaxa de foot-flagging (n eventos/min)") +
  ylab("Tempo até início da cópula\n")

## 2.3 Tempo ate amplexo vs DF
p3.10 = ggplot(sim_Afix10, aes(freqpad, ttot, color=freqpad)) +
  geom_point(shape=16, size=.05, show.legend=F, alpha = .5) +
  theme_minimal() +
  scale_color_gradient(low = "darkseagreen1", high = "darkslategrey") +
  xlab("\nFrequência dominante (Hz)") +
  ylab("Tempo até início da cópula\n")

## 2.4 Tempo ate amplexo vs SVL
p4.10 = ggplot(sim_Afix10, aes(tamapad, ttot, color=tamapad)) +
  geom_point(shape=16, size=.05, show.legend=F, alpha = .5) +
  theme_minimal() +
  scale_color_gradient(low = "darkseagreen1", high = "darkslategrey") +
  xlab("\nTamanho corporal (mm)") +
  ylab("Tempo até início da cópula\n")

grid.arrange(p1.10, p2.10, p3.10, p4.10, nrow = 2)
```

Modelos
```{r eval=FALSE}
glmm0full = glmer(ttot~tamapad*freqpad*footpad + (1|nsim), family = Gamma, data=sim_Afix10)
summary(glm(ttot~tamapad*freqpad*footpad, data=teste, family = Gamma))

```

### 4.1.2 Área fixa em 50

Análise exploratória

```{r}
# 1. Histograma de tempo ate inicio da copula
hist(sim_Afix50$ttot, main = "", xlab = "Tempo até início da cópula")

# 2. Scatter Plots

## 2.1 Tempo ate amplexo vs Prob. do macho ser escolhido
p1.50 = ggplot(sim_Afix50, aes(prob, ttot, color=prob)) +
  geom_point(shape=16, size = .2, show.legend = F, alpha = .5) +
  theme_minimal() +
  scale_color_gradient(low = "darkseagreen1", high = "darkslategrey") +
  xlab("\nProb. do macho ser escolhido") +
  ylab("Tempo até início da cópula\n")

## 2.2 Tempo ate amplexo vs taxa de foot-flagging
p2.50 = ggplot(sim_Afix50, aes(footpad, ttot, color=footpad)) +
  geom_point(shape=16, size=.2, show.legend=F, alpha = .5) +
  theme_minimal() +
  scale_color_gradient(low = "darkseagreen1", high = "darkslategrey") +
  xlab("\nTaxa de foot-flagging (n eventos/min)") +
  ylab("Tempo até início da cópula\n")

## 2.3 Tempo ate amplexo vs DF
p3.50 = ggplot(sim_Afix50, aes(freqpad, ttot, color=freqpad)) +
  geom_point(shape=16, size=.05, show.legend=F, alpha = .5) +
  theme_minimal() +
  scale_color_gradient(low = "darkseagreen1", high = "darkslategrey") +
  xlab("\nFrequência dominante (Hz)") +
  ylab("Tempo até início da cópula\n")

## 2.4 Tempo ate amplexo vs SVL
p4.50 = ggplot(sim_Afix50, aes(tamapad, ttot, color=tamapad)) +
  geom_point(shape=16, size=.05, show.legend=F, alpha = .5) +
  theme_minimal() +
  scale_color_gradient(low = "darkseagreen1", high = "darkslategrey") +
  xlab("\nTamanho corporal (mm)") +
  ylab("Tempo até início da cópula\n")

grid.arrange(p1.50, p2.50, p3.50, p4.50, nrow = 2)
```

Modelos

```{r}

```

### 4.1.3 Área fixa em 100

Análise exploratória

```{r}

```

Modelos

```{r}

```

## 4.2 Simulação com área variável

### 4.2.1 Análise exploratória
```{r echo=FALSE}
# 1. Histograma de tempo ate inicio da copula
hist(sim_Avar$ttot, main = "", xlab = "Tempo até início da cópula")

# 2. Scatter Plots

## 2.1 Tempo ate amplexo vs Prob. do macho ser escolhido
p1.var = ggplot(sim_Avar, aes(prob, ttot, color=prob)) +
  geom_point(shape=16, size = .2, show.legend = F, alpha = .5) +
  theme_minimal() +
  scale_color_gradient(low = "darkseagreen1", high = "darkslategrey") +
  xlab("\nProb. do macho ser escolhido") +
  ylab("Tempo até início da cópula\n")

## 2.2 Tempo ate amplexo vs taxa de foot-flagging
p2.var = ggplot(sim_Avar, aes(footpad, ttot, color=footpad)) +
  geom_point(shape=16, size=.2, show.legend=F, alpha = .5) +
  theme_minimal() +
  scale_color_gradient(low = "darkseagreen1", high = "darkslategrey") +
  xlab("\nTaxa de foot-flagging (n eventos/min)") +
  ylab("Tempo até início da cópula\n")

## 2.3 Tempo ate amplexo vs DF
p3.var = ggplot(sim_Avar, aes(freqpad, ttot, color=freqpad)) +
  geom_point(shape=16, size=.05, show.legend=F, alpha = .5) +
  theme_minimal() +
  scale_color_gradient(low = "darkseagreen1", high = "darkslategrey") +
  xlab("\nFrequência dominante (Hz)") +
  ylab("Tempo até início da cópula\n")

## 2.4 Tempo ate amplexo vs SVL
p4.var = ggplot(sim_Avar, aes(tamapad, ttot, color=tamapad)) +
  geom_point(shape=16, size=.05, show.legend=F, alpha = .5) +
  theme_minimal() +
  scale_color_gradient(low = "darkseagreen1", high = "darkslategrey") +
  xlab("\nTamanho corporal (mm)") +
  ylab("Tempo até início da cópula\n")

grid.arrange(p1.var, p2.var, p3.var, p4.var, nrow = 2)
```

### 4.2.2 GLMM x GLM
A principio, acreditamos que o GLMM é mais adequado para nossa estrutura de dados. No entanto, o modelo que gostaríamos de fazer não converge.
```{r eval=FALSE}
# O modelo full nao converge:

glmmfull = glmer(ttot~tamapad*freqpad*footpad*I(area^2) + (1|nsim), family = Gamma, data=sim_Avar)

# Error in pwrssUpdate(pp, resp, tol = tolPwrss, GQmat = GQmat, compDev = compDev,  : 
#   PIRLS loop resulted in NaN value

summary(lm(ttot~tamapad*freqpad*footpad*I(area^2), data=sim_Avar))
```

Por esse motivo, comparamos o modelo aleatório mais simples possível, apenas com a probabilidade de seleção dos machos. Pelo funcionamento da simulação, a variável <code>prob</code> deve abarcar toda a informação de <code>freq</code>, <code>foot</code> e <code>tama</code>. No entanto, essa probabilidade não é biologicamente plausível de ser coletada, e usamos aqui apenas para verificar a necessidade do uso do modelo misto.
```{r}
glmmP = glmer(ttot~prob + (1|nsim), family = Gamma, data=sim_Avar)

#Comparando o glmm com o glm:
glmP = glm(ttot~prob, family = Gamma, data=sim_Avar)

#Nao da pra descartar o efeito aleatorio
AICtab(glmmP, glmP)
```

O GLMM é infinitamente melhor que o GLM.

# 5. Resultados

# 6. Discussão

# 7. Referências

Duellman, W. E., & Trueb, L. (1986). Biology of Amphibians McGraw-Hill Inc. Nueva York, EUA.

Gingras, B., Mohandesan, E., Boko, D., & Fitch, W. (2013). Phylogenetic signal in the acoustic parameters of the advertisement calls of four clades of anurans. BMC Evolutionary Biology, 13(1), 1-12.

Goutte, S., Dubois, A., & Legendre, F. (2013). The importance of ambient sound level to characterise anuran habitat. Plos One, 8(10), e78020.

Haddad, C. F., & Giaretta, A. A. (1999). Visual and acoustic communication in the Brazilian torrent frog, *Hylodes asper* (Anura: Leptodactylidae). Herpetologica, 324-333.

Heyer, W. R., Rand, A. S., da Cruz, C. A. G., Peixoto, O. L., & Nelson, C. E. (1990). Frogs of Boracéia. Arquivos de Zoologia, 31(4), 231-410.

Hödl, W., Rodrigues, M. T., Accacio, G. M., Lara, P. H., Pavan, D., Schiesari, L., & Skuk, G. (1997). Foot-flagging display in the Brazilian stream-breeding frog *Hylodes asper* (Leptodactylidae). Scientific film, Ctf, 2703.

Köhler, J., Jansen, M., Rodríguez, A., Kok, P. J. R., Toledo, L. F., Emmrich, M., Glaw F., Haddad, C. F. B., Rodel, M., Vences, M. (2017). The use of bioacoustics in anuran taxonomy: Theory, terminology, methods and recommendations for best practice. Zootaxa, 4251, 1–124.

Martin, W. F. (1971). Mechanics of sound production in toads of the genus Bufo: passive elements. Journal of Experimental Zoology, 176(3), 273-293.

McClelland, B. E., Wilczynski, W. A. L. T. E. R., & Ryan, M. J. (1996). Correlations between call characteristics and morphology in male cricket frogs (Acris crepitans). The Journal of Experimental Biology, 199(9), 1907-1919.

Ryan, M. J. (1988). Constraints and patterns in the evolution of anuran acoustic communication. The evolution of the amphibian auditory system, 637-677.

Schmid, E. (1978). Contribution to the morphology and histology of the vocal cords of Central European anurans (Amphibia). Zoologische Jahrbucher Anatomie, 5, 133-150.

Wells, K. D. (1977). The social behaviour of anuran amphibians. Animal Behaviour, 25, 666-693.